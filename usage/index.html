<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Kevin Huck (khuck@cs.uoregon.edu)" /><link rel="canonical" href="http://khuck.github.io/xpress-apex/usage/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Usage - APEX</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Usage";
        var mkdocs_page_input_path = "usage.md";
        var mkdocs_page_url = "/xpress-apex/usage/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> APEX
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstarthpx/">Quick Start (HPX)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quick Start (standalone)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../feature/">Feature Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Usage</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#supported_runtime_systems">Supported Runtime Systems</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#hpx_louisiana_state_university">HPX (Louisiana State University)</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuring_hpx_with_apex">Configuring HPX with APEX</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_hpx_with_apex">Running HPX with APEX</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#openmp">OpenMP</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuring_apex_for_openmp_ompt_support">Configuring APEX for OpenMP OMPT support</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_openmp_applications_with_apex">Running OpenMP applications with APEX</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#openacc">OpenACC</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuring_apex_for_openacc_support">Configuring APEX for OpenACC support</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_openacc_programs_with_apex">Running OpenACC programs with APEX</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cuda">CUDA</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuring_apex_for_cuda_support">Configuring APEX for CUDA support</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_cuda_programs_with_apex">Running CUDA programs with APEX</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#kokkos">Kokkos</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuring_apex_for_kokkos_support">Configuring APEX for Kokkos support</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_kokkos_programs_with_apex">Running Kokkos programs with APEX</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#configuring_apex_for_raja_support">Configuring APEX for RAJA support</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_raja_programs_with_apex">Running RAJA programs with APEX</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#c_threads">C++ Threads</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuring_apex_for_c_thread_support">Configuring APEX for C++ Thread support</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_c_thread_programs_with_apex">Running C++ Thread programs with APEX</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#other_runtime_systems">Other Runtime Systems</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#performance_measurement_features">Performance Measurement Features</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#profiling">Profiling</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#profiling_with_csv_output">Profiling with CSV output</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#profiling_with_tau_profile_output">Profiling with TAU profile output</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#profiling_with_taskgraph_output">Profiling with Taskgraph output</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#profiling_with_scatterplot_output">Profiling with Scatterplot output</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#profiling_with_otf2_trace_output">Profiling with OTF2 Trace output</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#profiling_with_google_trace_events_format_output">Profiling with Google Trace Events Format output</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../environment/">Useful Environment Variables</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../spec/">API Specification</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../refman/">API Doxygen Reference</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">APEX</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Usage</li>
    <li class="wy-breadcrumbs-aside">
          <a href="http://github.com/khuck/xpress-apex/edit/master/docs/usage.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h1>
<h2 id="supported_runtime_systems">Supported Runtime Systems<a class="headerlink" href="#supported_runtime_systems" title="Permanent link">&para;</a></h2>
<h3 id="hpx_louisiana_state_university">HPX (Louisiana State University)<a class="headerlink" href="#hpx_louisiana_state_university" title="Permanent link">&para;</a></h3>
<p>HPX (High Performance ParalleX) is the original implementation of the ParalleX
model. Developed and maintained by the Ste||ar Group at Louisiana State
University, HPX is implemented in C++. For more information, see
<a href="http://stellar-group.org/projects/hpx/">http://stellar-group.org/projects/hpx/</a>.  For a tutorial on HPX with APEX
(presented at SC'15, Austin TX) see
<a href="https://github.com/khuck/SC15_APEX_tutorial">https://github.com/khuck/SC15_APEX_tutorial</a> (somewhat outdated).</p>
<p>APEX is configured and built as part of HPX. In fact, you don't even need to
donwload it separately - it will be automatically checked out from Github as
part of the HPX Cmake configuration.  However, you do need to pass the correct
Cmake options to the HPX configuration step.</p>
<h4 id="configuring_hpx_with_apex">Configuring HPX with APEX<a class="headerlink" href="#configuring_hpx_with_apex" title="Permanent link">&para;</a></h4>
<p>See <a href="../install/#installation_with_hpx">Intallation with HPX</a>.</p>
<h4 id="running_hpx_with_apex">Running HPX with APEX<a class="headerlink" href="#running_hpx_with_apex" title="Permanent link">&para;</a></h4>
<p>See <a href="../quickstarthpx/#runtime">APEX Quickstart</a>.</p>
<h3 id="openmp">OpenMP<a class="headerlink" href="#openmp" title="Permanent link">&para;</a></h3>
<p>The OpenMP API supports multi-platform shared-memory parallel programming in C/C++ and Fortran. The OpenMP API defines a portable, scalable model with a simple and flexible interface for developing parallel applications on platforms from the desktop to the supercomputer.  For more information, see <a href="http://openmp.org/">http://openmp.org/</a>.</p>
<h4 id="configuring_apex_for_openmp_ompt_support">Configuring APEX for OpenMP OMPT support<a class="headerlink" href="#configuring_apex_for_openmp_ompt_support" title="Permanent link">&para;</a></h4>
<p>The CMake process will automatically detect whether your compiler has OpenMP support.  If you configure APEX with <code>-DUSE_OMPT=TRUE</code> and have a compiler with full OpenMP 5.0 OMPT support, APEX will detect the support.  If your compiler is GCC, Intel or Clang and does <em>not</em> have native OMPT support, APEX can build and use the open source LLVM OpenMP runtime as a drop-in replacement for the compiler's native runtime library.</p>
<p>APEX uses Binutils to resolve the OpenMP outlined regions from instruction addresses to human-readable names, so also configure APEX with <code>-DUSE_BFD=TRUE</code> (see <a href="../install/#other_cmake_settings_depending_on_your_needswants">Other CMake Settings</a>).  The following example was configured and run with Intel 20 compilers.  The CMake configuration for this example was:</p>
<pre><code>cmake -DCMAKE_C_COMPILER=`which icc` -DCMAKE_CXX_COMPILER=`which icpc` -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=../install -DBUILD_TESTS=TRUE -DUSE_BFD=TRUE -DBFD_ROOT=/usr/local/packages/binutils/2.34 -DUSE_OMPT=TRUE ..
</code></pre>
<h4 id="running_openmp_applications_with_apex">Running OpenMP applications with APEX<a class="headerlink" href="#running_openmp_applications_with_apex" title="Permanent link">&para;</a></h4>
<p>Using the <code>apex_exec</code> wrapper script, execute the OpenMP program as normal:</p>
<pre><code>[khuck@delphi xpress-apex]$ ./install/bin/apex_exec --apex:screen --apex:taskgraph build/src/unit_tests/C++/apex_openmp_cpp
Program to run :  build/src/unit_tests/C++/apex_openmp_cpp
Initializing...
No Sharing...
Result: 2690568.772590

Elapsed time: 0.0398378 seconds
Cores detected: 72
Worker Threads observed: 72
Available CPU time: 2.86832 seconds

Counter                                   : #samples | minimum |    mean  |  maximum |  stddev
------------------------------------------------------------------------------------------------
Iterations: OpenMP Work Loop: no_shari... :       71   1.05e+06   1.05e+06   1.05e+06      0.000
Iterations: OpenMP Work Loop: my_init(... :      144   1.05e+06   1.05e+06   1.05e+06      0.000
                    OpenMP Initial Thread :        1      1.000      1.000      1.000      0.000
                     OpenMP Worker Thread :       71      1.000      1.000      1.000      0.000
Single: OpenMP Work Single Executor: L... :        1      1.000      1.000      1.000      0.000
Single: OpenMP Work Single Executor: L... :        2      1.000      1.000      1.000      0.000
Single: OpenMP Work Single Other: L__Z... :       71      1.000      1.000      1.000      0.000
Single: OpenMP Work Single Other: L__Z... :      142      1.000      1.000      1.000      0.000
                           status:Threads :        1      3.000      3.000      3.000      0.000
                            status:VmData :        1   1.07e+05   1.07e+05   1.07e+05      0.000
                             status:VmExe :        1     20.000     20.000     20.000      0.000
                             status:VmHWM :        1   9356.000   9356.000   9356.000      0.000
                             status:VmLck :        1      0.000      0.000      0.000      0.000
                             status:VmLib :        1   4.39e+04   4.39e+04   4.39e+04      0.000
                             status:VmPTE :        1    128.000    128.000    128.000      0.000
                            status:VmPeak :        1   2.49e+05   2.49e+05   2.49e+05      0.000
                             status:VmPin :        1      0.000      0.000      0.000      0.000
                             status:VmRSS :        1   9356.000   9356.000   9356.000      0.000
                            status:VmSize :        1   1.84e+05   1.84e+05   1.84e+05      0.000
                             status:VmStk :        1    136.000    136.000    136.000      0.000
                            status:VmSwap :        1      0.000      0.000      0.000      0.000
        status:nonvoluntary_ctxt_switches :        1     43.000     43.000     43.000      0.000
           status:voluntary_ctxt_switches :        1     46.000     46.000     46.000      0.000
------------------------------------------------------------------------------------------------

Timer                                                : #calls  |    mean  |   total  |  % total
------------------------------------------------------------------------------------------------
                                           APEX MAIN :        1      0.040      0.040    100.000
OpenMP Parallel Region: no_sharing(double*, doubl... :        1      0.006      0.006      0.211
OpenMP Parallel Region: my_init(double*) [{/home/... :        2      0.014      0.028      0.961
OpenMP Work Loop: no_sharing(double*, double*) [{... :       72      0.003      0.195      6.806
OpenMP Work Loop: my_init(double*) [{/home/users/... :      143      0.001      0.161      5.622
OpenMP Work Single Executor: L__Z10no_sharingPdS_... :        1      0.001      0.001      0.028
OpenMP Work Single Executor: L__Z7my_initPd_39__p... :        2      0.000      0.001      0.018
OpenMP Work Single Other: L__Z10no_sharingPdS__20... :       71      0.000      0.029      1.027
OpenMP Work Single Other: L__Z7my_initPd_39__par_... :      141      0.001      0.100      3.472
------------------------------------------------------------------------------------------------
                                        Total timers : 433
</code></pre>
<p>If GraphViz is installed on your system, the <code>dot</code> program will generate a taskgraph image based on the taskgraph.0.dot file that was generated by APEX:</p>
<p><img alt="OpenMP task graph" src="../img/openmp_taskgraph.png" /></p>
<h3 id="openacc">OpenACC<a class="headerlink" href="#openacc" title="Permanent link">&para;</a></h3>
<h4 id="configuring_apex_for_openacc_support">Configuring APEX for OpenACC support<a class="headerlink" href="#configuring_apex_for_openacc_support" title="Permanent link">&para;</a></h4>
<p>Nothing special needs to be done to enable OpenACC support.  If your compiler supports OpenACC (PGI, GCC 10+), then CMake will detect it and enable OpenACC support in APEX.</p>
<p>In this example, APEX was configured with GCC 10.0.0:</p>
<pre><code>cmake -DCMAKE_C_COMPILER=`which gcc` -DCMAKE_CXX_COMPILER=`which g++` -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=../install -DBUILD_TESTS=TRUE -DUSE_BFD=FALSE -DBFD_ROOT=/usr/local/packages/binutils/2.34 ..
</code></pre>
<h4 id="running_openacc_programs_with_apex">Running OpenACC programs with APEX<a class="headerlink" href="#running_openacc_programs_with_apex" title="Permanent link">&para;</a></h4>
<p>Enabling OpenACC support requires setting the <code>ACC_PROFLIB</code> environment variable with the path to <code>libapex.so</code>, or by using the <code>apex_exec</code> script with the <code>--apex:openacc</code> flag:</p>
<pre><code>[khuck@gorgon xpress-apex]$ ./install/bin/apex_exec --apex:screen --apex:taskgraph --apex:openacc ./build/src/unit_tests/C/apex_openacc
Program to run :  ./build/src/unit_tests/C/apex_openacc
Jacobi relaxation Calculation: 128 x 128 mesh
Device API: none Device type: default Device vendor: -1
Device API: CUDA Device type: nvidia Device vendor: -1
    0, 0.250000

Elapsed time: 0.451705 seconds
Cores detected: 160
Worker Threads observed: 1
Available CPU time: 0.451705 seconds

Counter                                   : #samples | minimum |    mean  |  maximum |  stddev
------------------------------------------------------------------------------------------------
                            OpenACC Gangs :      200      1.000   2560.500   5120.000   2559.500
                     OpenACC Vector Lanes :      200     32.000     32.000     32.000      0.000
                          OpenACC Workers :      200      1.000      1.000      1.000      0.000
OpenACC device alloc (implicit) parall... :      301     15.000    889.206   2.62e+05   1.51e+04
OpenACC device free (implicit) paralle... :      301      0.000      0.000      0.000      0.000
OpenACC enqueue data transfer (HtoD) (... :      200     16.000     20.000     24.000      4.000
                           status:Threads :        1      3.000      3.000      3.000      0.000
                            status:VmData :        1   1.81e+04   1.81e+04   1.81e+04      0.000
                             status:VmExe :        1     64.000     64.000     64.000      0.000
                             status:VmHWM :        1   4416.000   4416.000   4416.000      0.000
                             status:VmLck :        1      0.000      0.000      0.000      0.000
                             status:VmLib :        1   8640.000   8640.000   8640.000      0.000
                             status:VmPMD :        1     16.000     16.000     16.000      0.000
                             status:VmPTE :        1      3.000      3.000      3.000      0.000
                            status:VmPeak :        1   1.59e+05   1.59e+05   1.59e+05      0.000
                             status:VmPin :        1      0.000      0.000      0.000      0.000
                             status:VmRSS :        1   4416.000   4416.000   4416.000      0.000
                            status:VmSize :        1   9.34e+04   9.34e+04   9.34e+04      0.000
                             status:VmStk :        1    192.000    192.000    192.000      0.000
                            status:VmSwap :        1      0.000      0.000      0.000      0.000
        status:nonvoluntary_ctxt_switches :        1      0.000      0.000      0.000      0.000
           status:voluntary_ctxt_switches :        1     46.000     46.000     46.000      0.000
------------------------------------------------------------------------------------------------

Timer                                                : #calls  |    mean  |   total  |  % total
------------------------------------------------------------------------------------------------
                                           APEX MAIN :        1      0.452      0.452    100.000
                  OpenACC compute construct parallel :      200      0.001      0.215     47.492
             OpenACC device init (implicit) parallel :        1      0.081      0.081     17.965
OpenACC enqueue data transfer (HtoD) (implicit) p... :      200      0.000      0.002      0.523
OpenACC enqueue launch: main$_omp_fn$0 (implicit)... :      100      0.000      0.001      0.288
OpenACC enqueue launch: main$_omp_fn$1 (implicit)... :      100      0.000      0.001      0.267
              OpenACC enter data (implicit) parallel :      200      0.000      0.002      0.491
                             OpenACC enter data data :        1      0.000      0.000      0.078
               OpenACC exit data (implicit) parallel :      200      0.000      0.003      0.733
                              OpenACC exit data data :        1      0.000      0.000      0.043
                                           APEX Idle :                          0.145     32.120
------------------------------------------------------------------------------------------------
                                        Total timers : 1003
</code></pre>
<p><img alt="OpenACC task graph" src="../img/openacc_taskgraph.png" /></p>
<h3 id="cuda">CUDA<a class="headerlink" href="#cuda" title="Permanent link">&para;</a></h3>
<h4 id="configuring_apex_for_cuda_support">Configuring APEX for CUDA support<a class="headerlink" href="#configuring_apex_for_cuda_support" title="Permanent link">&para;</a></h4>
<p>Enabling CUDA support in APEX requires the <code>-DAPEX_WITH_CUDA=TRUE</code> flag and the <code>-DCUDA_ROOT=/path/to/cuda</code> CMake variables at configuration time.  CMake will look for the CUPTI and NVML libraries in the installation, and if found the support will be enabled.</p>
<pre><code>cmake -DCMAKE_C_COMPILER=`which gcc` -DCMAKE_CXX_COMPILER=`which g++` -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=../install -DBUILD_TESTS=TRUE -DUSE_BFD=TRUE -DAPEX_WITH_CUDA=TRUE -DCUDA_ROOT=/usr/local/packages/cuda/10.2 -DBFD_ROOT=/usr/local/packages/binutils/2.34 ..
</code></pre>
<h4 id="running_cuda_programs_with_apex">Running CUDA programs with APEX<a class="headerlink" href="#running_cuda_programs_with_apex" title="Permanent link">&para;</a></h4>
<p>Enabling CUDA support only requires using the <code>apex_exec</code> wrapper script.</p>
<pre><code>[khuck@gorgon xpress-apex]$ ./install/bin/apex_exec --apex:screen --apex:taskgraph ./build/src/unit_tests/CUDA/apex_cuda_cu
Program to run :  ./build/src/unit_tests/CUDA/apex_cuda_cu
On device: name=hello, value=10
On device: name=dello, value=11
On device: name=dello, value=12
On device: name=dello, value=13
On host: name=dello, value=14

Elapsed time: 0.410402 seconds
Cores detected: 160
Worker Threads observed: 1
Available CPU time: 0.410402 seconds

Counter                                   : #samples | minimum |    mean  |  maximum |  stddev
------------------------------------------------------------------------------------------------
          Device 0 GPU Clock Memory (MHz) :        1    877.000    877.000    877.000      0.000
              Device 0 GPU Clock SM (MHz) :        1    135.000    135.000    135.000      0.000
            Device 0 GPU Memory Free (MB) :        1   3.41e+04   3.41e+04   3.41e+04      0.000
            Device 0 GPU Memory Used (MB) :        1      0.197      0.197      0.197      0.000
        Device 0 GPU Memory Utilization % :        1      0.000      0.000      0.000      0.000
           Device 0 GPU NvLink Link Count :        1      6.000      6.000      6.000      0.000
           Device 0 GPU NvLink Speed MB/s :        1   2.58e+04   2.58e+04   2.58e+04      0.000
       Device 0 GPU NvLink Utilization C0 :        1      0.000      0.000      0.000      0.000
       Device 0 GPU NvLink Utilization C1 :        1      0.000      0.000      0.000      0.000
                   Device 0 GPU Power (W) :        1     38.912     38.912     38.912      0.000
             Device 0 GPU Temperature (C) :        1     33.000     33.000     33.000      0.000
               Device 0 GPU Utilization % :        1      0.000      0.000      0.000      0.000
       Device 0 PCIe RX Throughput (MB/s) :        1      1.000      1.000      1.000      0.000
       Device 0 PCIe TX Throughput (MB/s) :        1      3.000      3.000      3.000      0.000
                     GPU: Bytes Allocated :        2      6.000     11.000     16.000      5.000
                           status:Threads :        1      4.000      4.000      4.000      0.000
                            status:VmData :        1   5.72e+04   5.72e+04   5.72e+04      0.000
                             status:VmExe :        1     64.000     64.000     64.000      0.000
                             status:VmHWM :        1   1.77e+04   1.77e+04   1.77e+04      0.000
                             status:VmLck :        1      0.000      0.000      0.000      0.000
                             status:VmLib :        1   6.92e+04   6.92e+04   6.92e+04      0.000
                             status:VmPMD :        1     12.000     12.000     12.000      0.000
                             status:VmPTE :        1      7.000      7.000      7.000      0.000
                            status:VmPeak :        1   2.58e+05   2.58e+05   2.58e+05      0.000
                             status:VmPin :        1      0.000      0.000      0.000      0.000
                             status:VmRSS :        1   1.77e+04   1.77e+04   1.77e+04      0.000
                            status:VmSize :        1   1.93e+05   1.93e+05   1.93e+05      0.000
                             status:VmStk :        1    192.000    192.000    192.000      0.000
                            status:VmSwap :        1      0.000      0.000      0.000      0.000
        status:nonvoluntary_ctxt_switches :        1      0.000      0.000      0.000      0.000
           status:voluntary_ctxt_switches :        1    102.000    102.000    102.000      0.000
------------------------------------------------------------------------------------------------

Timer                                                : #calls  |    mean  |   total  |  % total
------------------------------------------------------------------------------------------------
                                           APEX MAIN :        1      0.410      0.410    100.000
                       GPU: Unified Memory copy DTOH :        1      0.000      0.000      0.001
                       GPU: Unified Memory copy HTOD :        1      0.000      0.000      0.001
                           GPU: Kernel(DataElement*) :        4      0.000      0.000      0.084
                               cudaDeviceSynchronize :        4      0.000      0.000      0.092
                                            cudaFree :        2      0.000      0.000      0.045
                                    cudaLaunchKernel :        4      0.000      0.000      0.007
                                   cudaMallocManaged :        2      0.104      0.208     50.601
launch [/home/users/khuck/src/xpress-apex/src/uni... :        4      0.001      0.003      0.798
                                           APEX Idle :                          0.199     48.371
------------------------------------------------------------------------------------------------
                                        Total timers : 22

</code></pre>
<p>To get additional information you can also enable the <code>--apex:cuda_driver</code> flag to see CUDA driver API calls, or enable the <code>--apex:cuda_counters</code> flag to enable CUDA counters.</p>
<pre><code>[khuck@gorgon xpress-apex]$ ./install/bin/apex_exec --apex:screen --apex:taskgraph --apex:cuda_counters --apex:cuda_driver ./build/src/unit_tests/CUDA/apex_cuda_cu
Program to run :  ./build/src/unit_tests/CUDA/apex_cuda_cu
On device: name=hello, value=10
On device: name=dello, value=11
On device: name=dello, value=12
On device: name=dello, value=13
On host: name=dello, value=14

Elapsed time: 0.309145 seconds
Cores detected: 160
Worker Threads observed: 1
Available CPU time: 0.309145 seconds

Counter                                   : #samples | minimum |    mean  |  maximum |  stddev
------------------------------------------------------------------------------------------------
          Device 0 GPU Clock Memory (MHz) :        1    877.000    877.000    877.000      0.000
              Device 0 GPU Clock SM (MHz) :        1    135.000    135.000    135.000      0.000
            Device 0 GPU Memory Free (MB) :        1   3.41e+04   3.41e+04   3.41e+04      0.000
            Device 0 GPU Memory Used (MB) :        1      0.197      0.197      0.197      0.000
        Device 0 GPU Memory Utilization % :        1      0.000      0.000      0.000      0.000
           Device 0 GPU NvLink Link Count :        1      6.000      6.000      6.000      0.000
           Device 0 GPU NvLink Speed MB/s :        1   2.58e+04   2.58e+04   2.58e+04      0.000
       Device 0 GPU NvLink Utilization C0 :        1      0.000      0.000      0.000      0.000
       Device 0 GPU NvLink Utilization C1 :        1      0.000      0.000      0.000      0.000
                   Device 0 GPU Power (W) :        1     38.912     38.912     38.912      0.000
             Device 0 GPU Temperature (C) :        1     33.000     33.000     33.000      0.000
               Device 0 GPU Utilization % :        1      0.000      0.000      0.000      0.000
       Device 0 PCIe RX Throughput (MB/s) :        1      2.000      2.000      2.000      0.000
       Device 0 PCIe TX Throughput (MB/s) :        1      3.000      3.000      3.000      0.000
GPU: Bandwith (GB/s) &lt;- Unified Memory... :        1     18.618     18.618     18.618      0.000
GPU: Bandwith (GB/s) &lt;- Unified Memory... :        1     11.770     11.770     11.770      0.000
   GPU: Bytes &lt;- Unified Memory copy DTOH :        1   6.55e+04   6.55e+04   6.55e+04      0.000
   GPU: Bytes &lt;- Unified Memory copy HTOD :        1   6.55e+04   6.55e+04   6.55e+04      0.000
                     GPU: Bytes Allocated :        3      0.000      7.333     16.000      6.600
           GPU: Dynamic Shared Memory (B) :        4      0.000      0.000      0.000      0.000
         GPU: Local Memory Per Thread (B) :        4      0.000      0.000      0.000      0.000
              GPU: Local Memory Total (B) :        4   1.36e+08   1.36e+08   1.36e+08      0.000
                GPU: Registers Per Thread :        4     32.000     32.000     32.000      0.000
              GPU: Shared Memory Size (B) :        4      0.000      0.000      0.000      0.000
            GPU: Static Shared Memory (B) :        4      0.000      0.000      0.000      0.000
      Unified Memory CPU Page Fault Count :        2      1.000      1.000      1.000      0.000
     Unified Memory GPU Page Fault Groups :        1      1.000      1.000      1.000      0.000
                           status:Threads :        1      4.000      4.000      4.000      0.000
                            status:VmData :        1   5.69e+04   5.69e+04   5.69e+04      0.000
                             status:VmExe :        1     64.000     64.000     64.000      0.000
                             status:VmHWM :        1   1.70e+04   1.70e+04   1.70e+04      0.000
                             status:VmLck :        1      0.000      0.000      0.000      0.000
                             status:VmLib :        1   6.92e+04   6.92e+04   6.92e+04      0.000
                             status:VmPMD :        1     16.000     16.000     16.000      0.000
                             status:VmPTE :        1      7.000      7.000      7.000      0.000
                            status:VmPeak :        1   2.58e+05   2.58e+05   2.58e+05      0.000
                             status:VmPin :        1      0.000      0.000      0.000      0.000
                             status:VmRSS :        1   1.70e+04   1.70e+04   1.70e+04      0.000
                            status:VmSize :        1   1.93e+05   1.93e+05   1.93e+05      0.000
                             status:VmStk :        1    192.000    192.000    192.000      0.000
                            status:VmSwap :        1      0.000      0.000      0.000      0.000
        status:nonvoluntary_ctxt_switches :        1      0.000      0.000      0.000      0.000
           status:voluntary_ctxt_switches :        1    100.000    100.000    100.000      0.000
------------------------------------------------------------------------------------------------

Timer                                                : #calls  |    mean  |   total  |  % total
------------------------------------------------------------------------------------------------
                                           APEX MAIN :        1      0.309      0.309    100.000
                       GPU: Unified Memory copy DTOH :        1      0.000      0.000      0.001
                       GPU: Unified Memory copy HTOD :        1      0.000      0.000      0.002
                           GPU: Kernel(DataElement*) :        4      0.000      0.001      0.353
                                     cuCtxGetCurrent :        2      0.000      0.000      0.002
                                      cuCtxGetDevice :        1      0.000      0.000      0.001
                                     cuCtxSetCurrent :        1      0.000      0.000      0.001
                                    cuCtxSynchronize :        4      0.000      0.001      0.349
                                         cuDeviceGet :        4      0.000      0.000      0.002
                                cuDeviceGetAttribute :      376      0.000      0.002      0.754
                                    cuDeviceGetCount :        1      0.000      0.000      0.008
                                     cuDeviceGetName :        4      0.000      0.000      0.046
                                     cuDeviceGetUuid :        4      0.000      0.000      0.002
                            cuDevicePrimaryCtxRetain :        1      0.111      0.111     35.773
                                 cuDeviceTotalMem_v2 :        4      0.002      0.006      2.022
                                      cuLaunchKernel :        4      0.000      0.000      0.005
                                   cuMemAllocManaged :        2      0.012      0.024      7.743
                                        cuMemFree_v2 :        2      0.000      0.000      0.051
                                 cuModuleGetFunction :        1      0.000      0.000      0.005
                               cudaDeviceSynchronize :        4      0.000      0.001      0.361
                                            cudaFree :        2      0.000      0.000      0.057
                                    cudaLaunchKernel :        4      0.000      0.000      0.051
                                   cudaMallocManaged :        2      0.060      0.120     38.773
launch [/home/users/khuck/src/xpress-apex/src/uni... :        4      0.000      0.001      0.442
                                           APEX Idle :                          0.041     13.195
------------------------------------------------------------------------------------------------
                                        Total timers : 433
</code></pre>
<p><img alt="CUDA task graph" src="../img/cuda_taskgraph.png" /></p>
<h3 id="kokkos">Kokkos<a class="headerlink" href="#kokkos" title="Permanent link">&para;</a></h3>
<h4 id="configuring_apex_for_kokkos_support">Configuring APEX for Kokkos support<a class="headerlink" href="#configuring_apex_for_kokkos_support" title="Permanent link">&para;</a></h4>
<p>Like OpenACC, nothing special needs to be done to enable Kokkos support.</p>
<h4 id="running_kokkos_programs_with_apex">Running Kokkos programs with APEX<a class="headerlink" href="#running_kokkos_programs_with_apex" title="Permanent link">&para;</a></h4>
<p>Enabling Kokkos support requires setting the <code>KOKKOS_PROFILE_LIBRARY</code> environment variable with the path to <code>libapex.so</code>, or by using the <code>apex_exec</code> script with the <code>--apex:kokkos</code> flag.</p>
<h4 id="configuring_apex_for_raja_support">Configuring APEX for RAJA support<a class="headerlink" href="#configuring_apex_for_raja_support" title="Permanent link">&para;</a></h4>
<p>Like OpenACC, nothing special needs to be done to enable RAJA support.</p>
<h4 id="running_raja_programs_with_apex">Running RAJA programs with APEX<a class="headerlink" href="#running_raja_programs_with_apex" title="Permanent link">&para;</a></h4>
<p>Enabling RAJA support requires setting the <code>RAJA_PLUGINS</code> environment variable with the path to <code>libapex.so</code>, or by using the <code>apex_exec</code> script with the <code>--apex:raja</code> flag.</p>
<h3 id="c_threads">C++ Threads<a class="headerlink" href="#c_threads" title="Permanent link">&para;</a></h3>
<p>APEX suports C++ threads on Linux, with the assumption that they are implemented on top of POSIX threads.</p>
<h4 id="configuring_apex_for_c_thread_support">Configuring APEX for C++ Thread support<a class="headerlink" href="#configuring_apex_for_c_thread_support" title="Permanent link">&para;</a></h4>
<p>Nothing special needs to be done to enable C++ thread support.</p>
<h4 id="running_c_thread_programs_with_apex">Running C++ Thread programs with APEX<a class="headerlink" href="#running_c_thread_programs_with_apex" title="Permanent link">&para;</a></h4>
<p>Enabling C++ Thread support requires using the <code>apex_exec</code> script with the <code>--apex:pthread</code> flag.  That will enable the preloading of a wrapper library to intercept <code>pthread_create()</code> calls.  A sample program with C++ threads is in the APEX unit tests:</p>
<pre><code>khuck@Kevins-MacBook-Air build % ../install/bin/apex_exec --apex:pthread src/unit_tests/C++/apex_fibonacci_std_async_cpp
Program to run :  src/unit_tests/C++/apex_fibonacci_std_async_cpp
usage: apex_fibonacci_std_async_cpp &lt;integer value&gt;
Using default value of 10
fib of 10 is 55 (valid value: 55)

Elapsed time: 0.005359 seconds
Cores detected: 8
Worker Threads observed: 178
Available CPU time: 0.042872 seconds

Timer                                                : #calls  |    mean  |   total  |  % total
------------------------------------------------------------------------------------------------
  fib(int, std::__1::shared_ptr&lt;apex::task_wrapper&gt;) :      177      0.001      0.171    --n/a--
                                           APEX MAIN :        1      0.005      0.005    100.000
------------------------------------------------------------------------------------------------
                                        Total timers : 177
</code></pre>
<p>Note that APEX detected 178 total OS threads.  That is because some C++ thread implementations (GCC, Clang, others) implement <em>every</em> <code>std::async()</code> call as a new OS thread, resulting in a <code>pthread_create()</code> call.</p>
<h3 id="other_runtime_systems">Other Runtime Systems<a class="headerlink" href="#other_runtime_systems" title="Permanent link">&para;</a></h3>
<p>We are currently evaluating support for TBB, OpenCL, SYCL/DPC++/OneAPI, among others.</p>
<h2 id="performance_measurement_features">Performance Measurement Features<a class="headerlink" href="#performance_measurement_features" title="Permanent link">&para;</a></h2>
<p>For all the following examples, we will use a simple CUDA program that is in the APEX unit tests.</p>
<h3 id="profiling">Profiling<a class="headerlink" href="#profiling" title="Permanent link">&para;</a></h3>
<p>Profiling with APEX is the usual and most simple mode of operation.  In order to profile an application and get a report at the end of execution, enable screen output (see <a href="/environment">Environment Variables</a> for details) and run an application linked with the APEX library or with the <code>apex_exec --apex:screen</code> flag (enabled by default).  The output should look like examples shown previously.</p>
<pre><code class="language-bash">[khuck@cyclops xpress-apex]$ export APEX_SCREEN_OUTPUT=1
[khuck@cyclops xpress-apex]$ ./build/src/unit_tests/CUDA/apex_cuda_cu
Found 4 total devices
On device: name=hello, value=10
On device: name=dello, value=11
On device: name=dello, value=12
On device: name=dello, value=13
On host: name=dello, value=14

Elapsed time: 0.46147 seconds
Cores detected: 160
Worker Threads observed: 1
Available CPU time: 0.46147 seconds

Counter                                   : #samples | minimum |    mean  |  maximum |  stddev
------------------------------------------------------------------------------------------------
                    1 Minute Load average :        1     13.320     13.320     13.320      0.000
          Device 0 GPU Clock Memory (MHz) :        1    877.000    877.000    877.000      0.000
              Device 0 GPU Clock SM (MHz) :        1   1530.000   1530.000   1530.000      0.000
            Device 0 GPU Memory Free (MB) :        1   1.34e+04   1.34e+04   1.34e+04      0.000
            Device 0 GPU Memory Used (MB) :        1   2.07e+04   2.07e+04   2.07e+04      0.000
        Device 0 GPU Memory Utilization % :        1     48.000     48.000     48.000      0.000
           Device 0 GPU NvLink Link Count :        1      6.000      6.000      6.000      0.000
           Device 0 GPU NvLink Speed MB/s :        1   2.58e+04   2.58e+04   2.58e+04      0.000
       Device 0 GPU NvLink Utilization C0 :        1      0.000      0.000      0.000      0.000
       Device 0 GPU NvLink Utilization C1 :        1      0.000      0.000      0.000      0.000
                   Device 0 GPU Power (W) :        1    240.573    240.573    240.573      0.000
             Device 0 GPU Temperature (C) :        1     73.000     73.000     73.000      0.000
               Device 0 GPU Utilization % :        1     95.000     95.000     95.000      0.000
       Device 0 PCIe RX Throughput (MB/s) :        1      5.000      5.000      5.000      0.000
       Device 0 PCIe TX Throughput (MB/s) :        1      0.000      0.000      0.000      0.000
                     GPU: Bytes Allocated :        2      6.000     11.000     16.000      5.000
                           status:Threads :        1      7.000      7.000      7.000      0.000
                            status:VmData :        1   2.77e+05   2.77e+05   2.77e+05      0.000
                             status:VmExe :        1     64.000     64.000     64.000      0.000
                             status:VmHWM :        1   2.19e+05   2.19e+05   2.19e+05      0.000
                             status:VmLck :        1      0.000      0.000      0.000      0.000
                             status:VmLib :        1   8.74e+04   8.74e+04   8.74e+04      0.000
                             status:VmPMD :        1     16.000     16.000     16.000      0.000
                             status:VmPTE :        1     35.000     35.000     35.000      0.000
                            status:VmPeak :        1   7.17e+05   7.17e+05   7.17e+05      0.000
                             status:VmPin :        1   1.67e+05   1.67e+05   1.67e+05      0.000
                             status:VmRSS :        1   2.19e+05   2.19e+05   2.19e+05      0.000
                            status:VmSize :        1   6.52e+05   6.52e+05   6.52e+05      0.000
                             status:VmStk :        1    192.000    192.000    192.000      0.000
                            status:VmSwap :        1      0.000      0.000      0.000      0.000
        status:nonvoluntary_ctxt_switches :        1      9.000      9.000      9.000      0.000
           status:voluntary_ctxt_switches :        1   1331.000   1331.000   1331.000      0.000
------------------------------------------------------------------------------------------------

Timer                                                : #calls  |    mean  |   total  |  % total
------------------------------------------------------------------------------------------------
                                           APEX MAIN :        1      0.461      0.461    100.000
                            GPU: Unified Memcpy DTOH :        1      0.000      0.000      0.001
                            GPU: Unified Memcpy HTOD :        1      0.000      0.000      0.001
                           GPU: Kernel(DataElement*) :        4      0.000      0.000      0.086
                               cudaDeviceSynchronize :        4      0.000      0.001      0.169
                                            cudaFree :        2      0.000      0.000      0.052
                                    cudaLaunchKernel :        4      0.000      0.000      0.021
                                   cudaMallocManaged :        2      0.135      0.269     58.397
launch [/home/users/khuck/src/xpress-apex/src/uni... :        4      0.028      0.110     23.870
                                           APEX Idle :                          0.080     17.403
------------------------------------------------------------------------------------------------
                                        Total timers : 22
</code></pre>
<h3 id="profiling_with_csv_output">Profiling with CSV output<a class="headerlink" href="#profiling_with_csv_output" title="Permanent link">&para;</a></h3>
<p>To enable CSV output, use one of the methods described in the <a href="/environment">Environment Variables</a> page, and run as the previous example.</p>
<pre><code class="language-bash">[khuck@cyclops xpress-apex]$ export APEX_CSV_OUTPUT=1
[khuck@cyclops xpress-apex]$ ./build/src/unit_tests/CUDA/apex_cuda_cu
Found 4 total devices
On device: name=hello, value=10
On device: name=dello, value=11
On device: name=dello, value=12
On device: name=dello, value=13
On host: name=dello, value=14

[khuck@cyclops xpress-apex]$ cat apex.0.csv
&quot;counter&quot;,&quot;num samples&quot;,&quot;minimum&quot;,&quot;mean&quot;&quot;maximum&quot;,&quot;stddev&quot;
&quot;1 Minute Load average&quot;,1,22,22,22,0
&quot;Device 0 GPU Clock Memory (MHz)&quot;,1,877,877,877,0
&quot;Device 0 GPU Clock SM (MHz)&quot;,1,1530,1530,1530,0
&quot;Device 0 GPU Memory Free (MB)&quot;,1,13411,13411,13411,0
&quot;Device 0 GPU Memory Used (MB)&quot;,1,20679,20679,20679,0
&quot;Device 0 GPU Memory Utilization %&quot;,1,58,58,58,0
&quot;Device 0 GPU NvLink Link Count&quot;,1,6,6,6,0
&quot;Device 0 GPU NvLink Speed MB/s&quot;,1,25781,25781,25781,0
&quot;Device 0 GPU NvLink Utilization C0&quot;,1,0,0,0,0
&quot;Device 0 GPU NvLink Utilization C1&quot;,1,0,0,0,0
&quot;Device 0 GPU Power (W)&quot;,1,255,255,255,0
&quot;Device 0 GPU Temperature (C)&quot;,1,75,75,75,0
&quot;Device 0 GPU Utilization %&quot;,1,99,99,99,0
&quot;Device 0 PCIe RX Throughput (MB/s)&quot;,1,7,7,7,0
&quot;Device 0 PCIe TX Throughput (MB/s)&quot;,1,2,2,2,0
&quot;GPU: Bytes Allocated&quot;,2,6,11,16,5
&quot;status:Threads&quot;,1,7,7,7,0
&quot;status:VmData&quot;,1,277120,277120,277120,0
&quot;status:VmExe&quot;,1,64,64,64,0
&quot;status:VmHWM&quot;,1,219008,219008,219008,0
&quot;status:VmLck&quot;,1,0,0,0,0
&quot;status:VmLib&quot;,1,87424,87424,87424,0
&quot;status:VmPMD&quot;,1,16,16,16,0
&quot;status:VmPTE&quot;,1,36,36,36,0
&quot;status:VmPeak&quot;,1,717248,717248,717248,0
&quot;status:VmPin&quot;,1,166528,166528,166528,0
&quot;status:VmRSS&quot;,1,219008,219008,219008,0
&quot;status:VmSize&quot;,1,652032,652032,652032,0
&quot;status:VmStk&quot;,1,192,192,192,0
&quot;status:VmSwap&quot;,1,0,0,0,0
&quot;status:nonvoluntary_ctxt_switches&quot;,1,8,8,8,0
&quot;status:voluntary_ctxt_switches&quot;,1,1276,1276,1276,0


&quot;task&quot;,&quot;num calls&quot;,&quot;total cycles&quot;,&quot;total microseconds&quot;
&quot;APEX MAIN&quot;,1,0,431162
&quot;GPU: Unified Memcpy DTOH&quot;,1,0,3
&quot;GPU: Unified Memcpy HTOD&quot;,1,0,4
&quot;GPU: Kernel(DataElement*)&quot;,4,0,1082
&quot;cudaDeviceSynchronize&quot;,4,0,9993
&quot;cudaFree&quot;,2,0,172
&quot;cudaLaunchKernel&quot;,4,0,66
&quot;cudaMallocManaged&quot;,2,0,194367
&quot;launch [/home/users/khuck/src/xpress-apex/src/unit_tests/CUDA/apex_cuda.cu:35]&quot;,4,0,164490
</code></pre>
<h3 id="profiling_with_tau_profile_output">Profiling with TAU profile output<a class="headerlink" href="#profiling_with_tau_profile_output" title="Permanent link">&para;</a></h3>
<p>To enable TAU profile output, use one of the methods described in the <a href="/environment">Environment Variables</a> page, and run as the previous example.  The output can be summarized with the TAU <code>pprof</code> command, which is installed with the TAU software.</p>
<pre><code class="language-bash">[khuck@cyclops xpress-apex]$ export APEX_CSV_OUTPUT=1
[khuck@cyclops xpress-apex]$ ./build/src/unit_tests/CUDA/apex_cuda_cu
Found 4 total devices
On device: name=hello, value=10
On device: name=dello, value=11
On device: name=dello, value=12
On device: name=dello, value=13
On host: name=dello, value=14

[khuck@cyclops xpress-apex]$ cat profile.0.0.0
9 templated_functions_MULTI_TIME
# Name Calls Subrs Excl Incl ProfileCalls #
&quot;GPU: Unified Memcpy DTOH&quot; 1 0 2.656 2.656 0 GROUP=&quot;TAU_USER&quot;
&quot;cudaFree&quot; 2 0 193.18 193.18 0 GROUP=&quot;TAU_USER&quot;
&quot;cudaMallocManaged&quot; 2 0 184435 184435 0 GROUP=&quot;TAU_USER&quot;
&quot;GPU: Unified Memcpy HTOD&quot; 1 0 4.64 4.64 0 GROUP=&quot;TAU_USER&quot;
&quot;GPU: Kernel(DataElement*)&quot; 4 0 355.293 355.293 0 GROUP=&quot;TAU_USER&quot;
&quot;cudaLaunchKernel&quot; 4 0 67.4 67.4 0 GROUP=&quot;TAU_USER&quot;
&quot;cudaDeviceSynchronize&quot; 4 0 811.244 811.244 0 GROUP=&quot;TAU_USER&quot;
&quot;launch [/home/users/khuck/src/xpress-apex/src/unit_tests/CUDA/apex_cuda.cu:35]&quot; 4 0 100327 100327 0 GROUP=&quot;TAU_USER&quot;
&quot;APEX MAIN&quot; 1 0 67830.2 354026 0 GROUP=&quot;TAU_USER&quot;
0 aggregates
32 userevents
# eventname numevents max min mean sumsqr
&quot;status:VmSwap&quot; 1 0 0 0 0
&quot;status:VmSize&quot; 1 652032 652032 652032 4.25146e+11
&quot;status:Threads&quot; 1 7 7 7 49
&quot;status:VmPeak&quot; 1 717248 717248 717248 5.14445e+11
&quot;Device 0 GPU Power (W)&quot; 1 224.057 224.057 224.057 50201.5
&quot;Device 0 GPU NvLink Speed MB/s&quot; 1 25781 25781 25781 6.6466e+08
&quot;status:VmExe&quot; 1 64 64 64 4096
&quot;status:nonvoluntary_ctxt_switches&quot; 1 12 12 12 144
&quot;Device 0 GPU Memory Utilization %&quot; 1 73 73 73 5329
&quot;status:VmStk&quot; 1 192 192 192 36864
&quot;status:VmData&quot; 1 277120 277120 277120 7.67955e+10
&quot;status:VmLck&quot; 1 0 0 0 0
&quot;status:VmPin&quot; 1 166528 166528 166528 2.77316e+10
&quot;status:VmPTE&quot; 1 35 35 35 1225
&quot;Device 0 GPU NvLink Utilization C1&quot; 1 0 0 0 0
&quot;status:VmHWM&quot; 1 219008 219008 219008 4.79645e+10
&quot;status:VmRSS&quot; 1 219008 219008 219008 4.79645e+10
&quot;GPU: Bytes Allocated&quot; 2 16 6 11 292
&quot;status:VmLib&quot; 1 87424 87424 87424 7.64296e+09
&quot;Device 0 GPU Utilization %&quot; 1 99 99 99 9801
&quot;status:voluntary_ctxt_switches&quot; 1 1320 1320 1320 1.7424e+06
&quot;Device 0 GPU Clock SM (MHz)&quot; 1 1530 1530 1530 2.3409e+06
&quot;status:VmPMD&quot; 1 20 20 20 400
&quot;1 Minute Load average&quot; 1 16.43 16.43 16.43 269.945
&quot;Device 0 GPU Clock Memory (MHz)&quot; 1 877 877 877 769129
&quot;Device 0 PCIe TX Throughput (MB/s)&quot; 1 2 2 2 4
&quot;Device 0 GPU Temperature (C)&quot; 1 73 73 73 5329
&quot;Device 0 PCIe RX Throughput (MB/s)&quot; 1 6 6 6 36
&quot;Device 0 GPU Memory Used (MB)&quot; 1 20679.1 20679.1 20679.1 4.27625e+08
&quot;Device 0 GPU NvLink Utilization C0&quot; 1 0 0 0 0
&quot;Device 0 GPU NvLink Link Count&quot; 1 6 6 6 36
&quot;Device 0 GPU Memory Free (MB)&quot; 1 13410.6 13410.6 13410.6 1.79845e+08

[khuck@cyclops xpress-apex]$ which pprof
~/src/tau2/ibm64linux/bin/pprof
[khuck@cyclops xpress-apex]$ pprof
Reading Profile files in profile.*

NODE 0;CONTEXT 0;THREAD 0:
---------------------------------------------------------------------------------------
%Time    Exclusive    Inclusive       #Call      #Subrs  Inclusive Name
              msec   total msec                          usec/call
---------------------------------------------------------------------------------------
100.0           67          354           1           0     354026 APEX MAIN
 52.1          184          184           2           0      92218 cudaMallocManaged
 28.3          100          100           4           0      25082 launch [/home/users/khuck/src/xpress-apex/src/unit_tests/CUDA/apex_cuda.cu:35]
  0.2        0.811        0.811           4           0        203 cudaDeviceSynchronize
  0.1        0.355        0.355           4           0         89 GPU: Kernel(DataElement*)
  0.1        0.193        0.193           2           0         97 cudaFree
  0.0       0.0674       0.0674           4           0         17 cudaLaunchKernel
  0.0      0.00464      0.00464           1           0          5 GPU: Unified Memcpy HTOD
  0.0      0.00266      0.00266           1           0          3 GPU: Unified Memcpy DTOH
---------------------------------------------------------------------------------------

USER EVENTS Profile :NODE 0, CONTEXT 0, THREAD 0
---------------------------------------------------------------------------------------
NumSamples   MaxValue   MinValue  MeanValue  Std. Dev.  Event Name
---------------------------------------------------------------------------------------
         1      16.43      16.43      16.43       0.01  1 Minute Load average
         1        877        877        877          0  Device 0 GPU Clock Memory (MHz)
         1       1530       1530       1530          0  Device 0 GPU Clock SM (MHz)
         1  1.341E+04  1.341E+04  1.341E+04      28.42  Device 0 GPU Memory Free (MB)
         1  2.068E+04  2.068E+04  2.068E+04       13.3  Device 0 GPU Memory Used (MB)
         1         73         73         73          0  Device 0 GPU Memory Utilization %
         1          6          6          6          0  Device 0 GPU NvLink Link Count
         1  2.578E+04  2.578E+04  2.578E+04      6.245  Device 0 GPU NvLink Speed MB/s
         1          0          0          0          0  Device 0 GPU NvLink Utilization C0
         1          0          0          0          0  Device 0 GPU NvLink Utilization C1
         1      224.1      224.1      224.1     0.1981  Device 0 GPU Power (W)
         1         73         73         73          0  Device 0 GPU Temperature (C)
         1         99         99         99          0  Device 0 GPU Utilization %
         1          6          6          6          0  Device 0 PCIe RX Throughput (MB/s)
         1          2          2          2          0  Device 0 PCIe TX Throughput (MB/s)
         2         16          6         11          5  GPU: Bytes Allocated
         1          7          7          7          0  status:Threads
         1  2.771E+05  2.771E+05  2.771E+05      74.83  status:VmData
         1         64         64         64          0  status:VmExe
         1   2.19E+05   2.19E+05   2.19E+05      63.75  status:VmHWM
         1          0          0          0          0  status:VmLck
         1  8.742E+04  8.742E+04  8.742E+04      64.99  status:VmLib
         1         20         20         20          0  status:VmPMD
         1         35         35         35          0  status:VmPTE
         1  7.172E+05  7.172E+05  7.172E+05      553.6  status:VmPeak
         1  1.665E+05  1.665E+05  1.665E+05      158.8  status:VmPin
         1   2.19E+05   2.19E+05   2.19E+05      63.75  status:VmRSS
         1   6.52E+05   6.52E+05   6.52E+05      520.6  status:VmSize
         1        192        192        192          0  status:VmStk
         1          0          0          0          0  status:VmSwap
         1         12         12         12          0  status:nonvoluntary_ctxt_switches
         1       1320       1320       1320          0  status:voluntary_ctxt_switches
---------------------------------------------------------------------------------------
</code></pre>
<h3 id="profiling_with_taskgraph_output">Profiling with Taskgraph output<a class="headerlink" href="#profiling_with_taskgraph_output" title="Permanent link">&para;</a></h3>
<p>APEX can capture the task dependency graph from the application, and output it as a GraphViz graph.  The graph represents summarized task "type" dependencies, not a full dependency graph/tree with every task instance.</p>
<pre><code class="language-bash">[khuck@cyclops xpress-apex]$ export APEX_TASKGRAPH_OUTPUT=1
[khuck@cyclops xpress-apex]$ export APEX_CUDA_DRIVER_API=1
[khuck@cyclops xpress-apex]$ ./build/src/unit_tests/CUDA/apex_cuda_cu
[khuck@cyclops xpress-apex]$ dot -Tpdf -O taskgraph.0.dot
</code></pre>
<p><img alt="CUDA task graph" src="../img/cuda_taskgraph.png" /></p>
<h3 id="profiling_with_scatterplot_output">Profiling with Scatterplot output<a class="headerlink" href="#profiling_with_scatterplot_output" title="Permanent link">&para;</a></h3>
<p>For this example, we are using an HPX quickstart example, the <code>fibonacci</code> example.  After execution, APEX writes a sample data file to disk, <code>apex_task_samples.csv</code>.  That file is post-processed with the APEX python script <code>task_scatterplot.py</code>.</p>
<pre><code class="language-bash">[khuck@cyclops xpress-apex]$ export APEX_TASK_SCATTERPLOT=1
[khuck@cyclops build]$ ./bin/fibonacci --n-value=20
[khuck@cyclops build]$ /home/users/khuck/src/xpress-apex/install/bin/task_scatterplot.py
Parsed 2362 samples
Plotting async_launch_policy_dispatch
Plotting async_launch_policy_dispatch::call
Plotting async
Rendering...
</code></pre>
<p><img alt="HPX task scatterplot" src="../img/fibonacci_scatterplot.png" /></p>
<h3 id="profiling_with_otf2_trace_output">Profiling with OTF2 Trace output<a class="headerlink" href="#profiling_with_otf2_trace_output" title="Permanent link">&para;</a></h3>
<p>For this example, we are using an APEX unit test that computes the value of PI.  OTF2 is the "Open Trace Format v2", used for tracing large scale HPC applications. For more information on OTF2 and associated tools, see <a href="https://www.vi-hps.org/projects/score-p/index.html">The VI-HPS Score-P web site</a>.  Vampir is a commercial trace viewer that can be used to visualize and analyze OTF2 trace data.  Traveler is an open source tool that can be used to visualize and analyze APEX OTF2 trace data.</p>
<pre><code class="language-bash">[khuck@cyclops xpress-apex]$ export APEX_OTF2=1
[khuck@cyclops xpress-apex]$ ./build/src/unit_tests/CUDA/pi_cu
Found 4 total devices
134217728
num streams 4
making streams
starting compute
n is 0
num darts in circle 0: 105418094
pi is 3.141704

Closing OTF2 event files...
Writing OTF2 definition files...
Writing OTF2 Global definition file...
Writing OTF2 Node information...
Writing OTF2 Communicators...
Closing the archive...
done.

[khuck@eagle xpress-apex]$ module load vampir
[khuck@eagle xpress-apex]$ vampir OTF2_archive/APEX.otf2
</code></pre>
<p><img alt="CUDA OTF2 trace in Vampir" src="../img/pi_cu_trace.png" /></p>
<h3 id="profiling_with_google_trace_events_format_output">Profiling with Google Trace Events Format output<a class="headerlink" href="#profiling_with_google_trace_events_format_output" title="Permanent link">&para;</a></h3>
<p>For this example, we are using an APEX unit test that computes the value of PI.  Google Trace Events is a format developed by Google for tracing activity on devices, but is free and open and JSON based. For more information on Google Trace Events and associated tools, see <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwiQ5uai8vrrAhV2JTQIHeTWDWcQFjAAegQIBRAB&amp;url=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU%2Fpreview&amp;usg=AOvVaw0tBFlVbDVBikdzLqgrWK3g">the Google Trace Event Format document</a>.  The Google Chrome Web Browser can be used to visualize and analyze GTE trace data.</p>
<pre><code>[khuck@cyclops xpress-apex]$ export APEX_TRACE_EVENT=1
[khuck@cyclops xpress-apex]$ ./build/src/unit_tests/CUDA/pi_cu
</code></pre>
<p><img alt="CUDA Google trace in Chrome" src="../img/pi_cu_gte.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../install/" class="btn btn-neutral float-left" title="Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../environment/" class="btn btn-neutral float-right" title="Useful Environment Variables">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>(C) 2014-2021 University of Oregon, All Rights Reserved</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="http://github.com/khuck/xpress-apex" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../install/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../environment/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
