<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Kevin Huck (khuck@cs.uoregon.edu)" /><link rel="canonical" href="http://UO-OACISS.github.io/apex/feature/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Feature Overview - APEX</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Feature Overview";
        var mkdocs_page_input_path = "feature.md";
        var mkdocs_page_url = "/apex/feature/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> APEX
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstarthpx/">Quick Start (HPX)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quick Start (standalone)</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Feature Overview</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#apex_motivation">APEX: Motivation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#supported_parallel_models">Supported Parallel Models</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#parallel_models_with_experimental_support_in_development_wish_list">Parallel Models with Experimental Support / In Development / Wish List</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#introspection">Introspection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#event_listeners">Event Listeners</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#profiling_listener">Profiling Listener</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tau_listener">TAU Listener</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#concurrency_tracking">Concurrency Tracking</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#otf2_tracing">OTF2 Tracing</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#google_trace_event_listener">Google Trace Event Listener</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#policy_listener">Policy Listener</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usage/">Usage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../environment/">Useful Environment Variables</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../spec/">API Specification</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../refman/">API Doxygen Reference</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">APEX</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Feature Overview</li>
    <li class="wy-breadcrumbs-aside">
          <a href="http://github.com/UO-OACISS/apex/edit/master/docs/feature.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="feature_overview">Feature Overview<a class="headerlink" href="#feature_overview" title="Permanent link">&para;</a></h1>
<h2 id="apex_motivation">APEX: Motivation<a class="headerlink" href="#apex_motivation" title="Permanent link">&para;</a></h2>
<p>Frequently, software components or even entire applications run into a situation where the context of the execution environment has changed in some way (or does not meet assumptions). In those situations, the software requires some mechanism for evaluating its own performance and that of the underlying runtime system, operating system and hardware. The types of adaptation that the software wants to do could include:</p>
<ul>
<li>Controlling concurrency<ul>
<li>to improve energy efficiency</li>
<li>for performance</li>
</ul>
</li>
<li>Parametric variability<ul>
<li>adjust the decomposition granularity for this machine / dataset</li>
<li>choose a different algorithm for better performance/accuracy</li>
<li>choose a different preconditioner for better performance/accuracy</li>
<li>choose a different solver for better performance/accuracy</li>
</ul>
</li>
<li>Load Balancing<ul>
<li>when to perform AGAS migration?</li>
<li>when to perform repartitioning?</li>
<li>when to perform data exchanges?</li>
</ul>
</li>
<li>Parallel Algorithms (for_each…) - choose a different execution model<ul>
<li>separate <em>what</em> from <em>how</em></li>
</ul>
</li>
<li>Address the “SLOW(ER)” performance model<ul>
<li>avoid <strong>S</strong>tarvation</li>
<li>reduce <strong>L</strong>atency</li>
<li>reduce <strong>O</strong>verhead</li>
<li>reduce <strong>W</strong>aiting</li>
<li>reduce <strong>E</strong>nergy consumption</li>
<li>improve <strong>R</strong>esiliency</li>
</ul>
</li>
</ul>
<p>APEX provides both <em>performance awareness</em> and <em>performance adaptation</em>.</p>
<ul>
<li>APEX provides top-down and bottom-up performance mapping and feedback.</li>
<li>APEX exposes node-wide resource utilization data and analysis, energy consumption, and health information in real time<ul>
<li>Software can subsequently associate performance state with policy for feedback control</li>
</ul>
</li>
<li>APEX introspection<ul>
<li>OS: track system resources, utilization, job contention, overhead</li>
<li>Runtime (e.g. HPX, OpenMP, CUDA, OpenACC, Kokkos...): track threads, queues, concurrency, remote operations, parcels, memory management</li>
<li>Application timer / counter observation</li>
</ul>
</li>
</ul>
<p><img alt="Screenshot" src="../img/APEX_arch.png" /></p>
<p><em>Above: APEX architecture diagram (when linked with an HPX application). The application and runtime send events to the APEX instrumentation API, which updates the performance state. The Policy Engine executes policies that change application behavior based on rule outcomes.</em></p>
<h2 id="supported_parallel_models">Supported Parallel Models<a class="headerlink" href="#supported_parallel_models" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>HPX</strong> - APEX is fully integrated into the HPX runtime, so that all tasks that are scheduled by the thread scheduler are measured by APEX.  In addition, all HPX counters are captured by APEX.</li>
<li><strong>C++ threads</strong> (<code>std::thread</code>, <code>std::async</code>) and vanilla <strong>POSIX threads</strong> - Using a <code>pthread_create()</code> wrapper, APEX can capture all spawned threads and measure the time spent in those top level functions.</li>
<li><strong>OpenMP</strong> - Using the OpenMP 5.0 OMPT interface, APEX can capture performance data related to OpenMP pragmas.</li>
<li><strong>OpenACC</strong> - Using the OpenACC Profiling interface, APEX can capture performance data related to OpenACC pragmas.</li>
<li><strong>Kokkos</strong> - Using the Kokkos profiling interface, APEX can capture performance data related to Kokkos parallel abstractions.</li>
<li><strong>RAJA</strong> - Using the RAJA profiling interface, APEX can capture performance data related to RAJA parallel abstractions.  Unlike Kokkos, RAJA doesn't give any details, so don't expect much.</li>
<li><strong>CUDA</strong> - Using the NVIDIA CUPTI and NVML libraries, APEX can capture runtime and driver API calls as well as memory transfers and kernels executed on a device, and monitor GPU utilization.</li>
<li><strong>HIP</strong> - Using the AMD Roctracer, Rocprofiler and ROCM-SMI libraries, APEX can capture runtime and driver API calls as well as memory transfers and kernels executed on a device, and monitor GPU utilization.</li>
<li><strong>Intel SYCL</strong> - Using the Intel Level0 libraries, APEX can capture runtime and driver API calls as well as memory transfers and kernels executed on a device, and monitor GPU utilization.</li>
<li><strong>PhiProf</strong> - APEX is integrated with support to intercept PhiProf profiling data. See <a href="https://github.com/fmihpc/phiprof">https://github.com/fmihpc/phiprof</a>.</li>
<li><strong>StarPU</strong> - APEX is integrated with support to profile StarPU. See <a href="https://starpu.gitlabpages.inria.fr">https://starpu.gitlabpages.inria.fr</a>.</li>
<li><strong>Distributed Execution over MPI</strong> - While APEX doesn't measure all MPI function calls, it is "MPI-aware", and can detect when used in a distributed run so that each process can write separate or aggregated performance data. APEX provides rudimentary support for measuring point-to-point and collectives.</li>
</ul>
<h2 id="parallel_models_with_experimental_support_in_development_wish_list">Parallel Models with Experimental Support / In Development / Wish List<a class="headerlink" href="#parallel_models_with_experimental_support_in_development_wish_list" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Argobots</strong> - APEX has been used to instrument services based on Argobots, but it is not integrated into the runtime.</li>
<li><strong>TBB</strong> - The APEX team is evaluating integrated TBB support.</li>
<li><strong>Legion</strong> - No plans at this time.</li>
<li><strong>Charm++</strong> - No plans at this time.</li>
<li><strong>Iris</strong> - Plans are afoot. Stay tuned.</li>
<li><strong>YAKL</strong> - Plans are afoot. Stay tuned.</li>
</ul>
<h2 id="introspection">Introspection<a class="headerlink" href="#introspection" title="Permanent link">&para;</a></h2>
<p>APEX collects data through <em>inspectors</em>. The synchronous data collection uses an event API and event <em>listeners</em>. The API includes events for:</p>
<ul>
<li>Initialize, terminate, thread creation, thread exit<ul>
<li>added to the HPX thread scheduler</li>
<li>added to the OpenMP runtime using the OMPT interface</li>
<li>added to the pthread runtime by wrapping the pthread API calls</li>
</ul>
</li>
<li>Timer start, stop, yield, resume<ul>
<li>added to HPX task scheduler</li>
<li>added to the OpenMP runtime using the OMPT interface</li>
<li>added to the pthread runtime by wrapping the pthread API calls</li>
<li>added to the CUDA runtime by subscribing to CUPTI callbacks and asynchronous GPU activity</li>
<li>added to the Kokkos runtime by registering for callbacks</li>
<li>added to the OpenACC runtime by registering for callbacks</li>
</ul>
</li>
<li>Sampled values<ul>
<li>counters from HPX</li>
<li>counters from OpenMP</li>
<li>counters from CUPTI</li>
</ul>
</li>
<li>Custom events (meta-events)<ul>
<li>useful for triggering policies</li>
</ul>
</li>
</ul>
<p>Asynchonous data collection does not rely on events, but occurs periodically.  APEX exploits access to performance data from lower stack components (i.e. the runtime) or by reading from the RCR blackboard (i.e., power, energy). Other operating system and hardware health data is collected through other interfaces:</p>
<ul>
<li>/proc/stat</li>
<li>/proc/cpuinfo</li>
<li>/proc/meminfo</li>
<li>/proc/net/dev</li>
<li>/proc/self/status</li>
<li>lm_sensors</li>
<li>power measurements</li>
<li>counters from NVIDIA Monitoring Library (NVML)</li>
<li>PAPI hardware counters and components</li>
</ul>
<h2 id="event_listeners">Event Listeners<a class="headerlink" href="#event_listeners" title="Permanent link">&para;</a></h2>
<p>There are a number of listeners in APEX that are triggered by the events passed in through the API. For example, the <strong>Profiling Listener</strong> records events related to maintaining the performance state.</p>
<h3 id="profiling_listener">Profiling Listener<a class="headerlink" href="#profiling_listener" title="Permanent link">&para;</a></h3>
<ul>
<li>Start Event: records the name/address of the timer, gets a timestamp (using rdtsc), returns a profiler handle</li>
<li>Stop Event: gets a timestamp, optionally puts the profiler object in a queue for back-end processing and returns</li>
<li>Sample Event: put the name &amp; value in the queue</li>
</ul>
<p>Internally to APEX, there is an asynchronous consumer thread that processes profiler objects and samples to build a performance profile (in HPX, this thread is processed/scheduled as an HPX thread/task), construct task graphs, and scatterplots of sampled task times.</p>
<h3 id="tau_listener">TAU Listener<a class="headerlink" href="#tau_listener" title="Permanent link">&para;</a></h3>
<p>The <strong>TAU Listener</strong> (used for postmortem analysis) synchronously passes all measurement events to TAU to build an offline profile or trace. TAU will also capture any other events for which it is configured, including MPI, memory, file I/O, etc.</p>
<h3 id="concurrency_tracking">Concurrency Tracking<a class="headerlink" href="#concurrency_tracking" title="Permanent link">&para;</a></h3>
<p>The <strong>concurrency listener</strong> (also used for postmortem analysis) maintains a timeline of total concurrency, periodically sampled from  within APEX.</p>
<ul>
<li>Start event: push timer ID on stack</li>
<li>Stop event: pop timer ID off stack</li>
</ul>
<p>An asynchronous consumer thread periodically logs the current timer for each thread. This thread will output a concurrency data report and gnuplot script at APEX termination.</p>
<h3 id="otf2_tracing">OTF2 Tracing<a class="headerlink" href="#otf2_tracing" title="Permanent link">&para;</a></h3>
<p>The <strong>OTF2 listener</strong> will construct a full event trace and write the events out to an <a href="https://www.vi-hps.org/projects/score-p/">OTF2</a> archive.  OTF2 files can be visualized with tools like <a href="https://tu-dresden.de/zih/forschung/projekte/vampir/index?set_language=en">Vampir</a> or <a href="https://github.com/hdc-arizona/traveler-integrated">Traveler</a>.  Due to the constraints of OTF2 trace collection, tasks that start on one OS thread and end on another OS thread are not supported.  Similarly, tasks/functions that are not perfectly nested are not supported by OTF2 tracing.  For those types of tasks, we recommend the Trace Event listener.</p>
<h3 id="google_trace_event_listener">Google Trace Event Listener<a class="headerlink" href="#google_trace_event_listener" title="Permanent link">&para;</a></h3>
<p>The <strong>Trace Event listener</strong> will construct a full event trace and write the events to one or more <a href="https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/edit#">Google Trace Event</a> trace files.  The files can be visualized with the Google Chrome web browser, by navigating to the <a href="https://ui.perfetto.dev">https://ui.perfetto.dev</a> URL. <!-- Other tools can be used to visualize or analyze traces, like <a href="https://chromium.googlesource.com/catapult">Catapult</a>. --></p>
<h2 id="policy_listener">Policy Listener<a class="headerlink" href="#policy_listener" title="Permanent link">&para;</a></h2>
<p>Policies are rules that decide on outcomes based on observed state.
Triggered policies are invoked by introspection API events.
Periodic policies are run periodically on asynchronous thread.
Polices are registered with the Policy Engine at program startup by runtime code and/or from the application.
Applications, runtimes, and the OS can register callback functions to be executed.
Callback functions define the policy rules - “If x &lt; y then...(take some action!)”.</p>
<ul>
<li>Enables runtime adaptation using introspection data</li>
<li>Engages actuators across stack layers</li>
<li>Is also used to involve online auto-tuning support</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../quickstart/" class="btn btn-neutral float-left" title="Quick Start (standalone)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../install/" class="btn btn-neutral float-right" title="Installation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>(C) 2014-2024 University of Oregon, All Rights Reserved</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="http://github.com/UO-OACISS/apex" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../quickstart/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../install/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
